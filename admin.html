<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
body { font-family: Arial, sans-serif; padding: 2rem; background: #0f0f0f; color: #f0f0f0; }
input, select, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; max-width: 400px; }
button { background:#ff4f81; border:none; color:#fff; cursor:pointer; }
button:hover { background:#e03c6d; }
#editor { height: 200px; background:#fff; color:#000; margin-bottom: 1rem; }
.logout-btn { background:#333; margin-top:1rem; }
</style>
</head>
<body>

<h1>Admin Panel</h1>
<button id="logoutBtn" class="logout-btn">Logout</button>

<h2>Create New Blog Post</h2>
<input type="text" id="title" placeholder="Post Title" required>
<input type="text" id="categories" placeholder="Categories (comma separated)">
<input type="text" id="tags" placeholder="Tags (comma separated)">
<label for="datetime">Publish Date/Time:</label>
<input type="datetime-local" id="datetime" required>
<div id="editor"></div>
<button id="publishBtn">Publish</button>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js";

// ===== Firebase Config =====
const firebaseConfig = {
    apiKey: "AIzaSyCHWMstWD8QwoT_kz2lBW8ZNXNlXerl-9c",
    authDomain: "xacanonblog.firebaseapp.com",
    projectId: "xacanonblog",
    storageBucket: "xacanonblog.firebasestorage.app",
    messagingSenderId: "319182532803",
    appId: "1:319182532803:web:3a4d33372643dd71d5f276",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ===== Quill Editor =====
const quill = new Quill('#editor', {
  theme: 'snow',
  placeholder: 'Write your post here...'
});

// ===== Auth check =====
onAuthStateChanged(auth, user => {
  if(!user){
    alert("Login required");
    window.location.href = "login.html";
  }
});

// ===== Logout button =====
document.getElementById("logoutBtn").addEventListener("click", () => {
  signOut(auth).then(() => window.location.href="login.html");
});

// ===== Publish Blog Post =====
document.getElementById("publishBtn").addEventListener("click", async () => {
  const title = document.getElementById("title").value.trim();
  const categories = document.getElementById("categories").value.split(",").map(c => c.trim()).filter(c => c);
  const tags = document.getElementById("tags").value.split(",").map(t => t.trim()).filter(t => t);
  const datetime = document.getElementById("datetime").value;
  const content = quill.root.innerHTML;

  if(!title || !content || !datetime){
    alert("Please fill all required fields");
    return;
  }

  try {
    await addDoc(collection(db, "blogPosts"), {
      title,
      content,
      categories,
      tags,
      publishAt: new Date(datetime),
      createdAt: serverTimestamp(),
      author: auth.currentUser.email
    });
    alert("Post published!");
    document.getElementById("title").value="";
    document.getElementById("categories").value="";
    document.getElementById("tags").value="";
    document.getElementById("datetime").value="";
    quill.setContents([]);
  } catch(err){
    console.error(err);
    alert("Error publishing post");
  }
});
</script>
</body>
</html>
